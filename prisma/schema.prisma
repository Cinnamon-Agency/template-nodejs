generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Role {
  id    String     @id @default(uuid()) @db.Uuid
  name  RoleType   @unique @default(USER)
  users UserRole[]

  @@map("roles")
}

model UserRole {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @db.Uuid
  roleId    String   @db.Uuid
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  role      Role     @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, roleId])
  @@map("user_roles")
}

model User {
  id                     String            @id @default(uuid()) @db.Uuid
  email                  String            @unique
  emailVerified          Boolean           @default(false)
  phoneNumber            String?
  phoneVerified          Boolean           @default(false)
  password               String?
  authType               AuthType
  notifications          Boolean?          @default(false)
  profilePictureFileName String?
  createdAt              DateTime          @default(now())
  updatedAt              DateTime          @updatedAt
  notificationsReceived  Notification[]    @relation("NotificationReceiver")
  notificationsSent      Notification[]    @relation("NotificationSender")
  projects               Project[]
  sessions               UserSession[]
  verificationUIDs       VerificationUID[]
  roles                  UserRole[]

  @@index([email, authType])
  @@map("users")
}

model Project {
  id            String        @id @default(uuid()) @db.Uuid
  name          String
  description   String
  deadline      DateTime
  userId        String        @db.Uuid
  projectStatus ProjectStatus @default(ACTIVE)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  mediaFiles    Media[]
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Media {
  id            String    @id @default(uuid()) @db.Uuid
  mediaType     MediaType
  mediaFileName String    @unique
  fileExtension String
  storagePath   String
  projectId     String    @db.Uuid
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  project       Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([mediaType])
}

model Notification {
  id               String           @id @default(uuid()) @db.Uuid
  senderId         String           @db.Uuid
  receiverId       String           @db.Uuid
  message          String
  read             Boolean          @default(false)
  notificationType NotificationType
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  receiver         User             @relation("NotificationReceiver", fields: [receiverId], references: [id], onDelete: Cascade)
  sender           User             @relation("NotificationSender", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([receiverId])
}

model UserSession {
  id           String            @id @default(uuid()) @db.Uuid
  userId       String            @db.Uuid
  refreshToken String            @db.VarChar(500)
  expiresAt    DateTime
  status       UserSessionStatus @default(ACTIVE)
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  user         User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([refreshToken], map: "refresh_token_idx")
}

model VerificationUID {
  id        String              @id @default(uuid()) @db.Uuid
  userId    String              @db.Uuid
  uid       String              @db.Uuid
  hash      String              @db.VarChar(255)
  type      VerificationUIDType
  createdAt DateTime            @default(now())
  updatedAt DateTime            @updatedAt
  user      User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([uid], map: "verification_uid_idx")
  @@index([userId])
}

model SupportRequest {
  id        String               @id @default(uuid()) @db.Uuid
  firstName String
  lastName  String
  email     String
  subject   String
  message   String
  status    SupportRequestStatus @default(OPEN)
  createdAt DateTime             @default(now())
  updatedAt DateTime             @updatedAt

  @@index([status])
  @@map("support_requests")
}

model PhoneVerificationCode {
  id          String   @id @default(uuid()) @db.Uuid
  userId      String   @db.Uuid
  phoneNumber String
  code        String
  expiresAt   DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("phone_verification_codes")
}

model LoginCode {
  id        String   @id @default(uuid()) @db.Uuid
  email     String
  code      String
  expiresAt DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
  @@map("login_codes")
}

model DeviceToken {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @db.Uuid
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([token])
  @@map("device_tokens")
}

enum MediaType {
  IMAGE
  VIDEO
}

enum NotificationType {
  EXAMPLE_NOTIFICATION
}

enum ProjectStatus {
  ACTIVE
  FINISHED
}

enum AuthType {
  GOOGLE
  APPLE
  USER_PASSWORD
}

enum UserSessionStatus {
  ACTIVE
  EXPIRED
  LOGGED_OUT
}

enum VerificationUIDType {
  REGISTRATION
  RESET_PASSWORD
  CHANGE_EMAIL
  EMAIL_VERIFICATION
  PHONE_VERIFICATION
}

enum RoleType {
  USER
  ADMIN
  SUPERADMIN
}

enum SupportRequestStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}
